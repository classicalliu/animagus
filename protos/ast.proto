syntax = "proto3";

package ast;

option go_package = "github.com/xxuejie/animagus/pkg/ast";

message Value {
  enum Type {
    // Primitive fields
    UINT64 = 0;
    NIL = 1;
    BOOL = 2;
    BYTES = 3;

    // In animagus, we distinguish args and params in the following way:
    // * If a Value struct contains an arg, it will be interpretted as a
    // function, when used in constructs such as REDUCE or MAP, args acts
    // as placeholders for the values to test/transform.
    // * Params, on the other hand, denotes user input when calling RPCs,
    // for example, a user might provide an amount to transfer, or an address
    // to transfer to, those will be represented via parameters
    ARG = 16;
    PARAM = 17;
    // Blockchain data structures
    SCRIPT = 18;
    CELL = 19;

    // TODO: header & transaction data structures

    // Compound fields
    APPLY = 22;
    REDUCE = 24;

    // List fields
    LIST = 25;
    MAP = 26;
    FILTER = 27;
    QUERY_CELLS = 28;

    // Cell get operations
    GET_CAPACITY = 48;
    GET_DATA = 49;
    GET_LOCK = 50;
    GET_TYPE = 51;

    // Script get operations
    GET_CODE_HASH = 52;
    GET_HASH_TYPE = 53;
    GET_ARGS = 54;

    // TODO: header & transaction get operations (18 in total)

    // Operations
    HASH = 73;

    NOT = 74;
    AND = 75;
    OR = 76;
    XOR = 77;

    EQUAL = 78;
    LESS = 79;

    LEN = 80;
    SLICE_BYTES = 81;
    INDEX = 82;

    PLUS = 83;
    MINUS = 84;
  }
  Type t = 1;
  oneof primitive {
    bool b = 2;
    uint64 u = 3;
    bytes raw = 4;
  }
  repeated Value children = 8;
}

message Call {
  string name = 1;
  Value result = 3;
}

message Root {
  repeated Call calls = 1;
}
